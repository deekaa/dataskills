---
title: "Data skills for social work professionals (HS 24)"
author: "Dorian Kessler"
date: !r December 2024
output:
  html_document:
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 4
    toc_float: yes
  pdf_document:
    toc: yes
    toc_depth: '4'
editor_options: 
  markdown: 
    wrap: 72
---

```{=html}
<style type="text/css">
h1 { font-size: 140%; }
h2 { font-size: 130%; }
h3 { font-size: 120%; }
</style>
```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(eval= TRUE)
```

# General information

-   Courses take place from 9.15-12 and from 13.15-16 and in room xxx if not otherwise mentioned

    -   For group work

        -   Thursday 10th:

        -   Friday 11th:

-   [Carefully study the module description]()

-   [Here you find a list of class members and contact information and groups.]()

## Welcome Email

Dear students,

A warm welcome to the module Data skills for social work professionals!

I would like to give you some important information on the course:

1.  Physical presence in the course is not mandatory except for the last day (Jan 17), but I strongly urge you to participate in the course during the first four days. For those who do work part-time: please schedule your work accordingly.

2.  I it is imperative that you have first experiences with R and RStudio and make sure it runs on your computer. Please follow the instructions in the "Installation of R and R-Studio" guide (<https://drive.switch.ch/index.php/s/ktNsnWxwkJ3olWG>), and if necessary, refer to the linked instructions on YouTube. If you have any questions, please feel free to contact us via email. Please use Copilot with the prompt below to guide you through the installation, explain the software to you in easy language and show you what you can do with it.

3.  Enroll on the moodle page (Kurs: Data skills for social work professionals (in English) - HS24 \| BFH Moodle – Die Lernplattform der Berner Fachhochschule) with the following key: HS24-bsc. At least a week before the course you will find a link to the script of the course as well as the relevant literature that you need to prepare and other relevant information. We wish you a successful preparation period and look forward to meeting you in person soon. Please let us know should you have any questions.

Kind regards

Dorian Kessler

------------------------------------------------------------------------

Text to enter into Co-Pilot ein (Microsoft Copilot in Bing; important: verwenden Sie den Unterhaltungsstil «im höheren Masse kreativ/creative mode» (Schaltfläche in der Mitte des Bildschirms)): Als Studierende(r) der Sozialen Arbeit möchte ich die Grundlagen der Programmiersprache R lernen, um statistische Datenanalysen für Projekte in der Sozialen Arbeit durchführen zu können. Ich habe keine Vorkenntnisse in Statistik oder Programmierung. Kannst du mir bitte eine schrittweise Einführung geben? Bitte beginne mit der Frage ob ich R und Rstudio installiert habe und wenn nein, unterstütze mich bei der Installation von R und RStudio. Zeige mir dann die grundlegenden Befehle und Funktionen von R. Ich würde ich gerne lernen, wie man einfache Datenanalysen durchführt (z.B. Mittelwertsvergleiche mit dplyr), Daten visualisiert (mit ggplot2) und Ergebnisse interpretiert. Folgende Dinge sind zu beachten:

-   Wähle ein schrittweises Vorgehen. Erzähle mir erst von dem nächsten Schritt, wenn ein Schritt abgeschlossen ist. Frage nach jedem Schritt nach, ob ich diesen erfolgreich abschliessen konnte, um sicherzustellen, dass ich alles richtig gemacht habe.

-   Sage mir als ersten Schritt genau wie ich mich visuell in RStudio orientieren kann und wo ich Eingaben machen muss. Wo befindet sich die Konsole/Skript/Datenübersicht/Dateienübersicht in RStudio?

-   Erkläre mir, was die Konsole ist und was ein R-Skript ist, wie man ein R-Skript erstellt und abspeichert und was der Zweck von Skripten ist. Arbeite mit mir mit einem R-Skript und sage mir, wie ich Befehle ausführen kann.

-   Bitte führe mich durch praktische Übungen und gebe mir Aufgaben, um das Gelernte zu festigen.

-   Biete mir Unterstützung bei Unklarheiten.

-   Arbeite mit Beispielen, welche für die Soziale Arbeit relevant sind. Erfinde relevante Daten aus den Bereichen Sozialhilfe oder Kindes- und Erwachsenenschutz.

-   Kommentiere den Code Zeile-für-Zeile detailliert aus, so dass ich ihn genau verstehe.

-   Biete mir am Schluss weitere Übungen an, falls ich Lust habe. Mache Vorschläge für Übungen.

-   Du bist eine R-Expert:in, weisst aber auch, dass angehende Sozialarbeiter:in in Sachen Programmierung wenig Wissen haben und das nicht technische Begriffe eine alltagssprachliche Erklärung benötigen.

-   Danke für deine motivierte Unterstützung und Hilfsbereitschaft! Du hilfst mir R zu lernen und dieses Wissen für Klient:innen einzusetzen.

-   Wichtige Details:

-   Bitte lasse das «print()» weg, falls nicht nötig.

-   Ergänze bei Strg jeweils Ctrl, falls gewisse Personen englische Windows Tastaturen haben.

# General Introduction

## Learning Goals

-   People gain awareness of data science tools and how they could be used for social work.

-   People learn how to critically evaluate data science products

-   People learn how to do data science with R.

    ![](images/clipboard-3611048152.png)

## What is data science?

-   Term that emerged ca. 10 years ago. Predecessors: Statistics, Data analysis.

-   The science of creating valuable information from data

-   Practice-oriented science

-   Combines technical and field expertise

## Datafication or why data science is becoming more important in the future

[![](images/clipboard-1435924333.png)](https://marketsplash.com/data-creation-statistics/)

-   [Data is the new oil](https://www.economist.com/leaders/2017/05/06/the-worlds-most-valuable-resource-is-no-longer-oil-but-data).

-   Data contains information on human behavior = **helps us better understand the human world and solve human problems.**

-   In the era of AI, ["data literacy"](https://api.swiss-academies.ch/site/assets/files/127302/data_literacy_charta_1405_online_de.pdf) becomes a key skill in all areas of life, including social work –\> it should be a basic competence

    -   Skills to interpret data

    -   Awareness of data and knowing how to use them

    -   Skills to analyze data

## How can data science benefit social work?

-   [Use cases in social work](https://drive.switch.ch/index.php/s/r3FcksvmwvSodpY)

## Data sources that are relevant for social work

### Public statistics

-   [BFS - Überblick](https://www.bfs.admin.ch/bfs/de/home/statistiken.html)
-   [Stattab (personalisierte Tabellen)](https://www.pxweb.bfs.admin.ch/pxweb/de/)
-   [Kantonale Datenplattformen](https://data.bs.ch/explore/dataset/100226/table/?disjunctive.publikationsjahr&disjunctive.indikator_name&sort=indikator_label)
-   [Amstat.ch](https://www.amstat.ch)

### Regular social surveys

-   [Swiss household panel](https://www.swissubase.ch/en/catalogue/studies/6097/18255/datasets/932/2358/files/document/19477/11791/physicalFile)
-   [Survey on health, aging and retirement](https://share-eric.eu/)
-   [Survey on income and living conditions](https://www.bfs.admin.ch/bfs/en/home/statistics/economic-social-situation-population/surveys/silc.html)
-   [Swiss Health Survey](https://www.bfs.admin.ch/bfs/de/home/statistiken/gesundheit/erhebungen/sgb.html)
-   [Swiss Mental Health Survey](https://www.obsan.admin.ch/de/publikationen/2023-psychische-gesundheit-erhebung-herbst-2022)
-   [European Social Survey](https://www.europeansocialsurvey.org/)
-   [World Values Survey](https://www.worldvaluessurvey.org/WVSContents.jsp)

### Found data

-   [Data not explicitly generated for research](https://www.bitbybitbook.com/)
-   Always on
-   Numbers, text, images, audio, video
-   Data from
    -   Online activity (digital communication etc.)
    -   Smartphone usage (calling, filming, walking etc.)
    -   Administrative registries
    -   Payments
    -   Smart devices
    -   Video surveillance

![](images/clipboard-2278665493.png)

-   Publicly owned individual data

-   Can be linked using social security numbers

![The Swiss federation and cantons store data about all of life’s aspects](images/clipboard-1957976842.png)

## Exercise

-   Develop an idea how data science could be used in social work based on the file "[Use cases in social work](https://drive.switch.ch/index.php/s/r3FcksvmwvSodpY)" together with Copilot/ChatGPT
-   Use the following prompt:

You are ChatGPT, and your task is to help me develop a practical example of how data science could be applied in social work. The goal should be an example that is highly useful. Use the file from Dorian Kessler on potential use cases as a reference. Guide me through targeted questions to understand my work context or area of interest and suggest the most relevant application.

Conversation steps:

Understand the context:

Ask me:

-   "Are you currently working in social work? If not, what area interests you most?"

-   "Who are the clients or groups you work with or aim to work with?"

-   "What are common tasks in this field?"

-   "What are the three most pressing problems in your field?"

-   "What data is currently available or could be collected to improve workflows?"

Suggest solutions:

Based on my answers and Dorian Kessler’s file, propose 1–2 realistic examples of how data science could address challenges or improve processes. Briefly explain the benefits.

Get feedback and refine:

Ask:

-   "Does this idea seem relevant and practical for your field? How could it be adjusted to fit better?"

Refine the example with my input and help me select the best option to share with my peers.

-   Post your final ideas on this [padlet](https://padlet.com/doriank1986/data-skills-2x8f5clm7anao11g)

## Course plan

-   [See module description]()

# Measuring the effects of social work

<!--# Time structure: why it is important to measure effects (9.30); counterfactual (Min 9.40); Excercise presentation (10.20-10.40); Data example (10.55-11.15); Data own excercise 11.15-11.50-->

## Why is it important to measure the effects of social work?

Improving practice with better knowledge

-   Understanding whether and how social work interventions and offers reach their goals (evaluation)

    -   Knowing the most effective interventions and offers

    -   Exercise

        -   [What conclusions would you draw from this paper for counseling clients thinking about gender affirmative surgey?](https://pubmed.ncbi.nlm.nih.gov/38699117/)

-   Legitimizing social work

    -   Gaining political support for social work

    -   Example:

        -   [Winterthur](https://www.buerobass.ch/fileadmin/Files/2021/2021_Reduktion_Falllast_Winterthur_Schlussbericht_DE.pdf)

-   Digitalization strongly facilitates measuring the effects of social work

    -   More outcome data (e.g. use of services)

    -   Easier randomization (e.g. changing formulations on a website to see whether it affects service usage)

## What is an effect and what not?

-   Effect = difference in the result with influencing variable versus without influencing variable (= **counterfactual** situation)

-   What is the **counterfactual** situation?

    -   The fictional world in which the influencing variable was not present.

<!-- -->

-   Exercise
    -   Talk to the person sitting next to you.
        -   What was the most important event in your life (family, education, work, health, social relationships)?
        -   What areas of your life have been affected by this event?
        -   What would these areas be like if the event had not happened (can you guess numbers)?
-   Example of effect measures in social work

[![](images/clipboard-851415407.png)](https://www.nber.org/papers/w30405)

-   Caution: "Wirkungsziele" are often not actual measures of "effects":

    -   [Federal Council guidelines for the labor market integration of persons with protection status S for cantons: 40% should have a job until the end of 2024](https://www.blick.ch/politik/40-prozent-sollen-stelle-haben-der-bundesrat-will-dass-mehr-ukrainerinnen-arbeiten-id19105587.html)
        -   Why does a canton (not) reaching the goal of 40% not say much about the effects of its measures?

## How can we measure the effects of social work with quantitative data?

### Asking experts

-   Asking individuals about the subjectively measured effect

-   Example: "On a scale from 0 to 10, how much does one daily glass of wine affect your health?"

-   Advantages

    -   Easy to measure: one question

    -   Subjective expertise: we know a lot about effects (e.g. pain killers)

-   Disadvantages

    -   We are unaware of the counterfactual

    -   Social desirability bias: we want to please the researcher

### Assessing correlations

-   Is there a systematic relationship between two dimensions?

-   Example: [wine consumption and dementia](https://pubmed.ncbi.nlm.nih.gov/9296132/)

-   Advantages

    -   Easy to measure: few questions
        -   Wine consumption
        -   Dementia symptoms

-   Disadvantages

    -   Often: correlation is not equal to causation
    -   Why do frequent wine drinkers have less dementia?

![<https://x.com/DBelardoMD/status/1860421340903182519>](images/Moewe.png)

### Experiments - the gold standard

-   Gold standard: best way to measure effects

-   [Let's run an experiment](https://www.youtube.com/watch?v=hLhXCo2jQkg)

    -   Design

        -   2 (or more) randomly constituted groups

        -   one receives treatment, the other doesn't

        -   2 measurements: before versus after treatment

    [![](images/clipboard-1967496396.png)](https://www.researchgate.net/figure/Illustration-of-a-randomised-controlled-trial-RCT-to-test-a-new-back-to-work_fig2_256031307)

    -   Examples:

        -   [A helping hand goes a long way](https://www.nber.org/papers/w30405){.uri}

[![](images/clipboard-3712462696.png)](https://www.technologyreview.com/2020/12/10/1013914/pfizer-biontech-vaccine-chart-covid-19/)

-   **Advantages:**

    -   Secure statements on causality

    -   Control over treatment

-   **Disadvantages:**

    -   Ethical problems

    -   High financial and administrative burden

    -   Often limited generalizability

    -   Low variance (often only two manifestations: treatment vs. no treatment)

    -   Social desirability (except in double-blind studies with placebo)

### Natural experiments

-   A random event/dimension (Z) influences independent variable (X) but not the outcome (Y)

![](images/clipboard-739871177.png)

-   Examples

    -   [Closing of youth clubs due to cuts in public budget (Z), less beneficial effects of youth clubs (X) and crime rates](https://www.dropbox.com/scl/fi/8euuwc937v67blc7w5k7x/Youth_Centres_CVL.pdf?rlkey=98zwrgouwvlk7c3g2eu5dku10&e=2&st=6nxfy7sx&dl=0) (Y)

    -   [Unemployment insurance reform (Z), financial stress (X) and birth weight](https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0264544) (Y)

    -   [Lockdowns in football stadiums (Z), racist climate (X) and black player performance (Y)](https://www.unil.ch/files/live/sites/de/files/working-papers/21.12.pdf)

-   Advantages:

    -   Statements on causality (!)

    -   Practically relevant

    -   No distortion due to deliberate manipulation

-   **Disadvantages:**

    -   Limited samples: Reproducability?

    -   Randomness hard to prove

### Exercise

-   Form four groups: one for each method to measure effects

-   Imagine this: you want to find out how meetings with social workers affect client well-being

-   Please define a research design according to your method of effect measurement

    -   What data would you analyze?

    -   What numbers would you calculate to measure the effect?

# Prediction and AI in social work

<!--# Why? (9.30); How does it work? (9.45); Excercise (11); Own test (12) -->

## Why should we use machines to predict in social work?

-   Prediction is an integral part of individual-level social work

    -   It is used for **diagnosis**

        -   Identifying clients' need for assistance

        -   The future developments of clients' outcomes without assistance is an integral part of diagnosis

        -   Based on predictions of future outcomes, we decide **which clients need our help most**

    -   It is also used for **treatment**

        -   When deciding on which action to take for our client (service, activity, intervention), we make predictions on [**which action will bring the greatest improvements?**](https://www.sciencedirect.com/science/article/pii/S0927537105000564)

-   On an aggregate level, we need to predict future need for services to ensure mobilization of adequate resources (i.e. asking for more funding)

    -   E.g. [expectations about case numbers in social assistance during covid](https://skos.ch/themen/sozialhilfe-und-corona/herausforderungen-fuer-das-soziale-system/)

-   Social workers, like all humans, [make mistakes when predicting future developments](https://academic.oup.com/bjsw/article-abstract/54/3/1150/7382101?redirectedFrom=fulltext).

-   Machines can help us predict outcomes more accurately, that's why we can call it artificial intelligence

    -   Helpfulness of machine predictions increase, the more data we have

## How do machine predictions work?

-   Basic technology: supervised machine learning

-   We need (a lot of) data about **outcomes** and **determinants** of these outcomes

    -   "Supervised", because we tell the computer what the outcome is and what the determinants are

-   Using prediction algorithms, the computer finds rules linking determinants to outcomes. These rule sets are a model.

-   There are simple and less simple prediction algorithms

    -   E.g., simple and rigid: Ordinary Least Squares

    -   E.g., complex and flexible: Neural Networks

        -   [Statquest for explanations of different algorithms](https://www.youtube.com/@statquest)

    -   In practice, [extreme gradient boosting](https://www.youtube.com/watch?v=OtD8wVaFm6E) is often used

-   Model is used to predict unknown outcomes with information on determinants

-   Prediction models are more useful for social work practice,

    -   the more precise machines can predict the outcome, and the [less biased](https://onlinelibrary.wiley.com/doi/abs/10.1002/widm.1356) they are.

    -   the clearer it is what can be done to prevent the outcome

    -   the more important it is to intervene early

## Examples

-   Exercise

    -   Please choose one of the following texts on applications of prediction algorithms in fields related to social work

        -   [Berman et al. - 2024 - Trustworthy AI in the public sector An empirical .pdf](https://drive.switch.ch/index.php/s/0BnVw64Ld3IlHzl)

        -   [Black et al. - 2003 - Is the Threat of Reemployment Services More Effect.pdf](https://drive.switch.ch/index.php/s/x03olQjgxDtiZAl)

        -   [Gilholm et al. - 2023 - Machine learning to predict poor school performanc.pdf](https://drive.switch.ch/index.php/s/vQ0wcVhosqs8r0X)

        -   [Kleinberg et al. - 2018 - Human Decisions and Machine Predictions.pdf](https://drive.switch.ch/index.php/s/ukrf4MrRG4dejE2)

        -   [Rittenhouse et al. - 2023 - Algorithms, Humans and Racial Disparities in Child.pdf](https://drive.switch.ch/index.php/s/ziuaAdJWjWDU358)

        -   [Stevenson and Doleac - 2022 - Algorithmic Risk Assessment in the Hands of Humans.pdf](https://drive.switch.ch/index.php/s/fuogL1edjahkUSE)

        -   [Tennakoon et al. - 2023 - Using electronic health record data to predict fut.pdf](https://drive.switch.ch/index.php/s/yUkYmA5PtK8AvRY)

        -   [Toros and Flaming - 2018 - Prioritizing Homeless Assistance Using Predictive .pdf](https://drive.switch.ch/index.php/s/JRn0ybFpXYpaiLg)

    -   Answer the following questions (some questions may not be answered based on information in the papers):

        -   What decisions are to be taken based on AI output? Decision-support or decision-making?

        -   What data are used to train the models? What are the outcomes, what are the influencing factors?

        -   How accurate is it? More or less than humans or bureaucratic rules?

        -   How biased is it? More or less than humans or bureaucratic rules?

        -   Would humans trust and use it?

        -   What are the effects of usage?

## How to train your own prediction model

-   Training a prediction model involves the following steps

    -   Acquiring the data with past observations of determinants and outcomes

    -   Split observations into training data and test data

    -   Maximizing predictive performance

        -   Measures of predictive performance

            -   Continuous outcomes

                -   usually mean squared error

            -   Categorical outcomes

                -   correctly classified

        -   Play around with the choice of prediction algorithm

        -   For algorithms that have parameters: play around

# Kompetenznachweis

-   You will analyze one of the following data sets and research questions

    -   [European Social Survey](https://www.europeansocialsurvey.org/)
        -   Biannual survey in more than 30 countries
        -   [Data](https://drive.switch.ch/index.php/s/vSytsi7wl1H1yf3)
        -   [Variables](https://drive.switch.ch/index.php/s/PvHOlINAPMoTOWN)
        -   Research question: Who are Social Workers? Sociodemographic and Socioeconomic Characteristics of Social Workers and their Well-Being in Europe
    -   [Data from youth centers Burgdorf](https://jugend.burgdorf.ch/jubu/index.php)
        -   [Gender composition before and after introducing mixed-gender youth center](https://drive.switch.ch/index.php/s/LoJjPR0XAVZWFYx)
            -   Research question: What was the effect of switching to a mixed-gender youth center on boys' and girls' attendance?
        -   [Gender and age composition before and after shifting from "Jugendbüro" to "offene Turnhalle"](https://drive.switch.ch/index.php/s/JCaEawuJWM63KyR)
            -   Research question: What was the effect of switching to "offene Turnhalle" on boys' and girls' attendance in different age categories?
    -   [Fokus Arbeit](https://www.biel-bienne.ch/de/fokusarbeit.html/2897)
        -   [Data and Variables](https://drive.switch.ch/index.php/s/eatQbxi4RjEFXKC)
        -   Research question: What was the effect of Fokus Arbeit on individuals vitality, perspectives, mastery, social support and which personal characteristics increased the effect of Fokus Arbeit?
        -   Also see [Regionaljournal](https://www.srf.ch/news/schweiz/hoechste-sozialhilfequote-nach-pilotprojekt-biel-zieht-durchzogene-bilanz) for a deeper understanding of what was done in the project

-   Form: presentation on final day

-   See [module description](https://moodle.bfh.ch/pluginfile.php/3161090/mod_resource/content/5/MB_Data%20skills%20for%20social%20work%20professionals.pdf?forcedownload=1)

# Introduction to R

## General Information about R

-   R is free and open source.

-   R has an array of powerful statistical methods.

-   All additional tools can freely downloaded, installed and loaded as so called packages.

-   With `ggplot2` R allows you to create beautiful figures.

-   With the `tidyverse` and `dplyr`, R has the simplest language for data preparation.

-   R is more than just statistical software (cf. `shiny`).

-   R is well known by ChatGPT.

## Data Science workflow

```{r Example: Basic workflow, echo=T, eval=F}
# Install required packages if they are not already installed
required_packages <- c("readxl", "dplyr", "tidyr", "ggplot2", "officer", "flextable")
installed_packages <- installed.packages()

for(pkg in required_packages){
  if(!(pkg %in% rownames(installed_packages))){
    install.packages(pkg)
  }
}

# Load the packages
library(readxl)
library(tidyverse)
library(ggplot2)
library(officer)
library(flextable)

# Set the working directory
setwd("C:/Users/kld1/Downloads/")

# 1. Download Excel file
# https://www.pxweb.bfs.admin.ch/pxweb/de/px-x-1304030000_134/-/px-x-1304030000_134.px/table/tableViewLayout2/

url <- "https://www.pxweb.bfs.admin.ch/sq/ecfd5274-e21f-4d26-9bcf-5326af3edc9a"
destfile <- "sozialhilfe.xlsx"

download.file(url, destfile, mode = "wb")

# 2. Read and process data

# Read the Excel sheet (if multiple sheets exist, choose the correct one)
# Assuming the data is in the first sheet
raw_data <- read_excel(destfile, sheet = 1, skip = 2)  # Skip the first 2 rows containing metadata

# Process the data: Select columns, rename, filter rows
data <- raw_data %>%
  select(Kanton='...2', contains("20")) %>%
  filter(!is.na(Kanton), Kanton %in% c("Bern / Berne", "Zürich", "Basel-Stadt", "Genève"))

# Transform the data from wide to long format
long_data <- data %>%
  pivot_longer(
    cols = `2009`:`2022`,
    names_to = "Year",
    values_to = "Count"
  ) %>%
  mutate(Year = as.integer(Year),
         Count = as.numeric(Count))

# 3. Create a plot with ggplot2

# Create a nice ggplot graphic
plot <- ggplot(long_data, aes(x = Year, y = Count, color = Kanton)) +
  geom_line(size = 1) +
  theme_minimal() +
  labs(
    title = "Number of Social Assistance Recipients per Canton (2009-2022)",
    x = "Year",
    y = "Number of Recipients",
    color = "Canton"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.text = element_text(size = 10),
    axis.title = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )

# Save the plot as an image to insert into Word
ggsave("sozialhilfe_plot.png", plot = plot, width = 12, height = 8, dpi = 300)

# 4. Insert the plot into a Word document

# Create a new Word document
doc <- read_docx()

# Add a title
doc <- doc %>%
  body_add_par("Number of Social Assistance Recipients per Canton (2009-2022)", style = "heading 1")

# Add the plot
doc <- doc %>%
  body_add_img(src = "sozialhilfe_plot.png", width = 6, height = 4, style = "centered")

# Optional: Add a table with the data
# Create an example table (here the first 10 rows)
table_data <- long_data %>%
  filter(Kanton %in% c("Bern / Berne", "Zürich", "Basel-Stadt", "Genève"))  

ft <- flextable(table_data) %>%
  # Automatically adjust column widths to fit content
  autofit() %>%
  # Set table width to 100% of the document width
  width(j = 1:3, width = 1.5) %>%  # Adjust individual column widths if necessary
  set_table_properties(width = 1, layout = "autofit") %>%
  # Optional: Enhance table aesthetics
  theme_box() %>%
  fontsize(size = 10, part = "all") %>%
  bold(part = "header")  # Bold the header row

# Add the table
doc <- doc %>%
  body_add_par("Example Table of the Data", style = "heading 2") %>%
  body_add_flextable(ft)

# Save the Word document
print(doc, target = "Social_Assistance_Report.docx")


```

-   RStudio Environment

    -   Console Window
    -   Source Editor (Syntax window)
    -   File Window, Plot Window
    -   Environment Window, History Window

## AI coding assistants

-   ChatGPT and other frontier Large Language Models know R pretty well (Copilot also works, but the [newest models](https://huggingface.co/spaces/lmarena-ai/chatbot-arena-leaderboard) are more able)

-   After you ask a question, tell ChatGPT how your data look like.

-   If you have no sensitive data, just paste the data in to show ChatGPT the structure. If you have sensitive data, just paste the header (= variable names). With Copilot, data protection issues are smaller.

-   Paste the resulting code back into the R-Script and run the code

-   If you have errors, paste the error (from the console) back into ChatGPT and tell it to solve the problem.

-   Tell ChatGPT to only give you relevant code, if you adapt parts your overall code.

-   If it doesn't comment code, ask to comment and explain what each piece of code does.

### Exercise: throwing you in at the deep end

-   Open a new R script, copy the above code into it and save it

-   Copy the code above into [ChatGPT](https://chatgpt.com/) or [Copilot](https://copilot.cloud.microsoft/?fromcode=cmc&redirectid=EA5A38658CDC4AD29387F73CD32353C6&auth=2)

-   Ask it to assist you while giving helpful and targeted advice, i.e. that it should tell you how to change the code. Try the following tasks:

    -   Exercise 1: Add Luzern and Waadt to the plot and table
    -   Exercise 2: Make the plot more beautiful by adding dots to the lines and by making sure every year is displayed on the x-Axis
    -   Exercise 3: Develop a bar chart that displays the number of social assistance recipients for each canton for the year 2022 ordered by number of recipients. Ensure the chart includes appropriate titles and axis labels. Also ask it to label the bars with the values (with vertical alignment). Save the bar chart as a PNG file.

## Reading in data

-   R allows you to read in data in all formats, including directly from the internet (see `rvest`).

-   The most common data storage format are Excel tables. You can open them with the `readxl` package.

-   The most universal data storage format is csv (comma separated values).

-   The best way to deal with large data are the `data.table` (to read in large csv-data-files) and the `arrow` packages (to save and read in large data).

```{r readindata,eval=FALSE,echo=TRUE}

#Set the working directory. Here we use the download folder

setwd("C:/Users/kld1/Downloads/")

#Download data to the folder by hand

#Büro: https://drive.switch.ch/index.php/s/gdNYHopxWDCV9hr
#Turnhalle: https://drive.switch.ch/index.php/s/am1T36ehPL24QuQ

#Install and load excel package
install.packages("readxl")
library(readxl)

#Read in data from the working directory

Buero <- read.excel("OJAOffice_Statistikdaten_Jugendbüro Oberburg 23.xlsx",sheet="Statistikdaten 2024")
Turnhalle<- read.excel("OJAOffice_Statistikdaten_offene Turnhalle 24.xlsx",sheet="Statistikdaten 2024")

#Explain objects, observations and variables
#Explain range und col_names = FALSE



```

### Looking at data

-   RStudio allows you to manually scroll through data

-   This helps you better understand what is going on

```{r lookingatdata,eval=FALSE,echo=TRUE}
#Explain what rows (observations) and columns (variables) are.
#You can either click on the object or...

#use View()
View(Buero)
View(Turnhalle)

#Or even fix data (never do this!)
fix(Buero)

```

### Exercise: reading in data and looking at it

1.  Goal: read in data necessary for measuring the change of gender composition after introduction of mixed gender youth club in Summer 2023.
2.  For each file, what are the column names under which you find information on the date of the attendance, the number of attendees and the age and gender composition of the attendees?

| **Object name data should be saved with** | **Year** | **Sheet to read in and additional restrictions** | **Source Link** |
|------------------|------------------|------------------|------------------|

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `Maedels_22` | 2022 | Statistikdaten 2024 | [OJAOffice_Statistikdaten_Moditrff.xlsx](https://drive.switch.ch/index.php/s/mlV5AtoG6VbjR40) |

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `Maedels_23` | 2023 | Moditräff | [Statistik OJA Angebote Burgdorf 2023.xlsx](https://drive.switch.ch/index.php/s/wb6lEtNpvcOu05u) |

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `Jungs_22` | 2022 | Gieleträff | [OJAOffice_Statistikdaten_Gieltrff.xlsx](https://drive.switch.ch/index.php/s/jdvcpCXNNGCesz8) |

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `Jungs_23` | 2023 | Gieleträff, range="A11:B11",col_names = FALSE | [Statistik OJA Angebote Burgdorf 2023.xlsx](https://drive.switch.ch/index.php/s/wb6lEtNpvcOu05u) |

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `JuBu_23` | 2023 | JuBU Träff 5&6 | [Statistik OJA Angebote Burgdorf 2023.xlsx](https://drive.switch.ch/index.php/s/wb6lEtNpvcOu05u) |

|  |  |  |  |
|------------------|------------------|------------------|------------------|
| `JuBu_24` | 2024 | Statistikdaten 2024 | [Copy of OJAOffice_Statistikdaten_Mittelstufentreff 24.xlsx](https://drive.switch.ch/index.php/s/3XloagU1LkJIZCI) |

### Solution: reading in data and looking at it

```{r solutionreadin,echo=FALSE,eval=FALSE}

Mädels_22 <- read_excel("OJAOffice_Statistikdaten_Moditrff.xlsx")
Mädels_23 <- read_excel("Statistik OJA Angebote Burgdorf 2023.xlsx",sheet = "Moditräff")
Jungs_22 <- read_excel("OJAOffice_Statistikdaten_Gieltrff.xlsx")
Jungs_23 <- read_excel("Statistik OJA Angebote Burgdorf 2023.xlsx",sheet = "Gieläträff",
                       range = "A1:B11",#Welche Daten aus dem Excel brauchen wir; Spalte A, Zeile 1 is Spalte B Zeile 11
                       col_names = FALSE)#die erste Zeile enthält nicht die Spaltennamen sondern Messwerte
JuBu_23 <- read_excel("Statistik OJA Angebote Burgdorf 2023.xlsx",sheet = "JuBU Träff 5&6")
JuBu_24 <- read_excel("Copy of OJAOffice_Statistikdaten_Mittelstufentreff 24.xlsx",sheet = "Statistikdaten 2024")


View(Mädels_22)


```

## Simple data manipulation with dplyr

### General

-   package [dplyr](http://blog.rstudio.org/2014/01/17/introducing-dplyr/) by [Hadley Wickham](https://twitter.com/hadleywickham)/[Romain Francois](https://twitter.com/romain_francois) offers a toolset for data preparation
-   See [the dplyr vignette](http://cran.rstudio.com/web/packages/dplyr/vignettes/introduction.html) and the [Data Wrangling Cheat Sheet](http://www.rstudio.com/resources/cheatsheets/) for a very good overview
-   `filter()`: selects a subset of rows (see also `slice()`)
-   `arrange()`: sorts
-   `select()`: selects columns
-   `mutate()`: creates new columns
-   `summarize()`: aggregates (collapses) data to individual data points
-   `distinct()`: removes duplicate values
-   `group_by()`: defines subgroups in the data so that `mutate()` and `summarize()` can be applied separately per group.
-   dplyr can be used very well together with so-called piping, i.e. the data object is passed from function to function by `%>%`, which makes the code much easier to read and more compact.

### Example: Package dplyr

```{r Example: Package dplyr2,eval=FALSE}
#install package

#install.packages("dplyr")

#load package
library(dplyr)

setwd("C:/Users/kld1/switchdrive/BFH/Wichtige Dokumente/Lehre/Data skills for social work professionals/BFH/Daten/Fokus Arbeit/")

focarb <- read.csv("FokusArbeit_Wirkung.csv")

#Select: select the variables Vitality1 (=measurement of vitality before the intervention), Vitality2 (=measurement of vitality before the intervention) and intervention (did the person participate in Fokus Arbeit or recieve standard counseling)
focarb <- focarb %>%
  select(Vitality1,Vitality2,Interventionsgruppe)%>%
#Filter: out observations that have a missing value (NA = not available) on the measurement before the intervention. Use logical operators to set the filter condition. Logical operators: 
#  is missing: is.na(), 
#  bigger than: >, 
#  smaller than: <, 
#  equals: ==, 
#  not equal to: !=, 
#  not: !, 
#  or: |, 
#  is element of: %in%, 
#  is infinite: is.inf()).
  filter(!(is.na(Vitality1)))%>%
#Mutate: calculate a new variable that measures the change in vitality before versus after
  mutate(Change_Vitality=Vitality2-Vitality1)


#Plot the distribution of the change for the two groups 

ggplot(focarb,aes(x=Change_Vitality,
                  fill=factor(Interventionsgruppe)))+
  geom_density(alpha=.5)

```

### Exercise: simple data manipulation with dplyr

-   Goal: find out the share of social workers among the working population in Europe and in Switzerland.

-   Read in [data from the European Social Survey](https://drive.switch.ch/index.php/s/vSytsi7wl1H1yf3) with the following steps:

    -   Use the password to download the data

    -   Relocate the working directory (using `setwd()`) to your download folder or move the data to your working directory

    -   Make sure you have the `arrow` package installed (otherwise use `install.packages("arrow")`).

    -   Read in the data with the `read_parquet()` command.

    -   Save it into the object `ess`.

-   Find out which variables measure the country of origin and the occupation of the respondent using the variable list. Hint 1: start searching from the top. Hint 2: Occuption is measured with the ISCO08 classification. For earlier years, it is the ISCO88 classification, but the data is reduced to years with the isco08 classification (after 2010). Use the [variable list](https://drive.switch.ch/index.php/s/PvHOlINAPMoTOWN) to find the exact variable names and labels.

-   Reduce the data frame to those two variables: country, ISCO08.

-   Filter out observations of individuals where information on ISCO08 is missing. The following values should be excluded:

    |       |                  |
    |-------|------------------|
    | 66666 | Not applicable\* |
    | 77777 | Refusal\*        |
    | 88888 | Don't know\*     |
    | 99999 | No answer\*      |

-   Create a new variable `socialworker` that measures whether someone is a social worker or not (click on the variable to know which numbers stand for social workers). Use the `ifelse()` function to define the variable.

-   Calculate the share of social workers in the whole data set using `prop.table(table())`. How many social workers per 100 working people are there in Switzerland?

-   Reduce the data frame to people from Switzerland and repeat. Are there more social workers per 100 people in Switzerland than in total Europe?

### Solution: simple data manipulation with dplyr

```{r solution dplyr, echo=FALSE,eval=FALSE}
#install and load the arrow package 
#install.packages("arrow")
library(arrow)
library(dplyr)
#Set working directory to your download folder
setwd("C:/Users/kld1/switchdrive/BFH/Wichtige Dokumente/Lehre/Data skills for social work professionals/BFH/Daten/European Social Survey/")

#Load in data
ess <- read_parquet("ESS.parquet")

#Select variables with information on country and occupation

ess <- ess%>%
  select(cntry,isco08)

#Filter out people with no information on job

ess <- ess%>%
  filter(isco08<10000)

#Is someone a social worker
ess <- ess %>%
  mutate(socialworker= ifelse(isco08 == 2635, "Social Worker","Not a social worker"))

#What is the share of social workers in total
prop.table(table(ess$socialworker))

#What is the share of social workers in Switzerland

swiss<-ess%>%
  filter(cntry=="CH")
prop.table(table(swiss$socialworker))

#Add on: What is the country with the highest share of social workers

ranking<-ess%>%
  group_by(cntry)%>%
  summarise(sharesw=mean(socialworker=="Social Worker"))%>%
  arrange(sharesw)

#Make a graph that plots the ranking of countries

library(ggplot2)
ggplot(ranking,aes(x=reorder(cntry,-sharesw),y=sharesw*100))+
  geom_bar(stat="identity")+
  labs(x="Country",y="%-Share of Working Population is Social Worker")
```

## Merging and reshaping data

### Rbind, cbind

### Merge

## Dealing with text and dates

### Regular expressions --\> ChatGPT

### Grepl

### Gsub

## Univariate analysis

### Frequencies and distributions

### Mean, median, mode

## Analysing associations

### Frequency tables

### Grouped mean

### Linear models

## Nice tables

### Huxtable

## Nice graphs

### Ggplot2

## Workflow

-   Save graphs as png and link them into word

-   Save tables as docx and link them into word
